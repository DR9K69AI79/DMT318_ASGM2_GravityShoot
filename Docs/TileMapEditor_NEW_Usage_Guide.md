# TileMapEditor 全新使用指南

## 🎯 重构后的新特性

### ✨ 实时交互模式
- **无需切换模式**：通过按键实时激活不同功能
- **流畅体验**：松开按键即恢复普通放置模式
- **直观操作**：所见即所得的操作反馈

### 🌟 智能全向堆叠
- **表面法线检测**：自动识别碰撞表面的方向
- **智能旋转对齐**：根据表面自动调整物体朝向
- **精确堆叠**：考虑物体实际大小进行偏移计算

### 🎨 增强预览系统
- **放置预览**：透明显示即将放置的物体
- **删除预览**：红色高亮显示要删除的目标
- **智能隐藏**：在不合适的模式下自动隐藏预览

## 🔧 操作指南

### 基本交互
```
普通模式：     点击放置 Tiles
Shift + 拖拽： 连续绘制模式
Ctrl + 点击：  删除模式
Alt + 点击：   从场景拾取对象
```

### 快捷键
```
R键：    旋转选中的Prefab (90度递增)
Q/E键：  调整放置高度 (±heightStep)
G键：    切换网格显示
F1键：   显示详细帮助
ESC键：  取消选择/停止绘制
```

### 视觉指示器
- **黄色框**：普通放置模式
- **绿色框**：绘制模式（拖拽时）
- **红色框**：删除模式
- **青色框**：拾取模式
- **紫色线**：表面法线指示器
- **青色平面**：当前工作高度
- **坐标轴**：位置参考（红X，绿Y，蓝Z）

## 📋 界面说明

### 左侧面板
1. **交互模式说明**：实时显示当前可用操作
2. **状态显示**：当前激活的模式
3. **设置选项**：网格对齐、显示选项等
4. **参数调整**：网格大小、高度、旋转角度
5. **Prefab分类**：按功能分组的模型库

### 工具栏
1. **地图操作**：新建、保存、加载
2. **状态信息**：选中对象、Tiles数量、工作高度
3. **实时状态**：当前交互模式显示

### 主面板
1. **使用说明**：详细的操作指导
2. **智能堆叠说明**：全向堆叠功能介绍
3. **地图统计**：当前地图的Tiles统计

## 🌟 智能全向堆叠详解

### 工作原理
1. **表面检测**：射线检测碰撞表面
2. **法线计算**：获取表面法线方向
3. **智能偏移**：根据对象大小计算偏移距离
4. **旋转对齐**：使对象与表面对齐

### 适用场景
- 在墙壁上放置装饰
- 在坡面上建造结构
- 在天花板上悬挂物体
- 任意角度的表面堆叠

### 视觉反馈
- **紫色法线**：显示堆叠方向
- **位置标签**：显示精确坐标
- **高度信息**：显示工作平面

## 🎨 预览系统

### 放置预览
- 半透明显示将要放置的对象
- 实时跟随鼠标位置
- 根据表面法线自动旋转

### 删除预览
- 红色框高亮目标对象
- 显示对象边界信息
- 确认删除目标

## 💾 数据管理

### 地图保存
- JSON格式存储
- 包含位置、旋转、Prefab名称
- 支持增量保存

### 地图加载
- 自动重建场景
- 保持原始层次结构
- 错误处理和提示

## 🚀 性能优化

### 碰撞检测优化
- 多重射线检测
- 预览对象排除
- 距离优先排序

### 渲染优化
- 智能预览显示/隐藏
- 条件性Gizmos绘制
- 高效的材质处理

## 🐛 故障排除

### 常见问题
1. **预览不显示**：检查是否选中了Prefab
2. **堆叠不准确**：调整网格大小和偏移参数
3. **旋转异常**：确保表面法线正确检测
4. **保存失败**：检查文件路径权限

### 调试技巧
- 使用F1查看详细帮助
- 观察Scene视图中的视觉指示器
- 检查Console面板的调试信息

## 📈 未来改进方向

### 计划功能
- [ ] 多选和批量操作
- [ ] 自定义快捷键绑定
- [ ] 材质和纹理变体支持
- [ ] 地形自动生成工具
- [ ] 性能分析和优化工具

### 反馈和建议
如有问题或建议，请通过以下方式反馈：
- 创建Issue
- 提交Pull Request
- 联系开发团队

---

**版本**: 2.0 重构版  
**最后更新**: 2025年6月21日  
**兼容性**: Unity 2022.3+
