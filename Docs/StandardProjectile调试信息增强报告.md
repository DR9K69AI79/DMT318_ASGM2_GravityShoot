# StandardProjectile调试信息增强报告

## 概述
为StandardProjectile的伤害处理流程添加了详细的调试信息，以便更好地debug伤害应用问题。调试信息覆盖了从碰撞检测到伤害应用再到投射物销毁的完整生命周期。

## 增强的调试信息范围

### 1. 碰撞处理调试 (`ProcessHit` 方法)
**调试标签：** `[标准投射物-碰撞]`

**增加的信息：**
- 碰撞开始/结束标记（分隔线）
- 命中目标的详细信息（名称、位置、法线）
- 碰撞状态检查（是否已命中、是否可穿透）
- 伤害处理调用和结果
- 爆炸逻辑触发状态
- 最终销毁决定

**示例输出：**
```
[标准投射物-碰撞] ===== 开始处理碰撞 =====
[标准投射物-碰撞] 命中目标: Player
[标准投射物-碰撞] 碰撞点: (1.5, 2.0, 3.2)
[标准投射物-碰撞] 法线: (0, 1, 0)
[标准投射物-碰撞] 已命中状态: False, 可穿透: False
[标准投射物-碰撞] 开始处理伤害逻辑
[标准投射物-碰撞] 伤害处理结果: shouldDestroy = True
[标准投射物-碰撞] 最终销毁决定: True
[标准投射物-碰撞] ===== 碰撞处理结束 =====
```

### 2. 伤害处理调试 (`ProcessDamage` 方法)
**调试标签：** `[标准投射物-伤害]`

**增加的信息：**
- 伤害处理开始/结束标记
- 目标详细信息（名称、标签、层级）
- 伤害设置检查（伤害开关、伤害值）
- 目标合格性检查（是否可伤害、是否存活）
- 爆头检测结果
- 伤害应用前的详细参数
- ApplyDamageToTarget调用结果
- 穿透逻辑处理

**示例输出：**
```
[标准投射物-伤害] ===== 开始伤害处理 =====
[标准投射物-伤害] 目标: Player
[标准投射物-伤害] 目标标签: Player
[标准投射物-伤害] 目标层级: 8
[标准投射物-伤害] 伤害开关: True
[标准投射物-伤害] 投射物伤害值: 25.0
[标准投射物-伤害] ✅ 目标符合伤害条件
[标准投射物-伤害] ✅ 目标可以被伤害
[标准投射物-伤害] 爆头检测结果: False
[标准投射物-伤害] ApplyDamageToTarget返回结果: ✅ 成功
[标准投射物-伤害] ===== 伤害处理结束 =====
```

### 3. 爆炸伤害调试 (`Explode` 方法)
**调试标签：** `[标准投射物-爆炸]`

**增加的信息：**
- 爆炸处理开始/结束标记
- 爆炸参数详情（位置、半径、伤害、层级）
- 检测到的目标数量
- 每个目标的详细处理过程：
  - 距离计算和伤害衰减
  - IDamageable组件查找
  - 伤害应用前后的生命值
  - 本地接口回退处理
- 最终伤害统计

**示例输出：**
```
[标准投射物-爆炸] ===== 开始爆炸处理 =====
[标准投射物-爆炸] 爆炸位置: (5.2, 1.0, 8.1)
[标准投射物-爆炸] 爆炸半径: 3.0
[标准投射物-爆炸] 爆炸伤害: 50.0
[标准投射物-爆炸] 检测到 2 个潜在目标
[标准投射物-爆炸] 目标 Player:
[标准投射物-爆炸]   距离: 1.5
[标准投射物-爆炸]   伤害倍数: 0.5
[标准投射物-爆炸]   最终伤害: 25.0
[标准投射物-爆炸] ✅ 对 Player 应用爆炸伤害
[标准投射物-爆炸] 总共对 1 个目标造成伤害
[标准投射物-爆炸] ===== 爆炸处理结束 =====
```

### 4. 投射物销毁调试 (`DestroyProjectile` 方法)
**调试标签：** `[投射物-销毁]`

**增加的信息：**
- 销毁处理开始/结束标记
- 投射物基本信息（名称、位置、存在时间）
- 销毁方式选择（网络销毁 vs 本地销毁）
- PhotonView状态检查
- 销毁过程中的异常处理

**示例输出：**
```
[投射物-销毁] ===== 开始销毁投射物 =====
[投射物-销毁] 投射物名称: Bullet(Clone)
[投射物-销毁] 当前位置: (10.2, 3.5, 15.8)
[投射物-销毁] 存在时间: 2.35秒
[投射物-销毁] 本地投射物，执行本地销毁
[投射物-销毁] ===== 投射物销毁完成 =====
```

## 使用建议

### 1. 启用调试信息
在StandardProjectile组件的Inspector中：
- 勾选"Show Debug Info"选项
- 确保Console窗口可见

### 2. 调试伤害问题的步骤
1. **检查碰撞**：查看是否正确检测到碰撞
2. **检查目标合格性**：确认目标有正确的标签和层级
3. **检查IDamageable组件**：确认目标有IDamageable接口
4. **检查伤害应用**：观察伤害值计算和应用过程
5. **检查生命值变化**：确认目标生命值是否正确减少

### 3. 常见问题诊断
- **没有碰撞**：检查碰撞体设置和层级配置
- **伤害无效**：检查_damageOnTouch开关和伤害值设置
- **目标无反应**：检查IDamageable组件和IsAlive状态
- **爆炸无效果**：检查爆炸参数和_damageableLayers设置

## 性能注意事项
- 调试信息仅在`_showDebugInfo`为true时输出
- 生产环境中建议关闭调试信息以提高性能
- 大量投射物时可能产生大量日志，注意Console性能

## 后续优化
1. 可考虑添加可视化调试（如Gizmos显示爆炸范围）
2. 可添加伤害数值的颜色编码（成功=绿色，失败=红色）
3. 可集成到专门的调试UI面板中

---
**增强完成时间：** 2025年6月26日  
**影响文件：** StandardProjectile.cs, ProjectileBase.cs  
**调试标签：** 4个主要分类，便于过滤日志  
**状态：** 已完成，可立即用于调试
