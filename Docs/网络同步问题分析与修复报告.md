# ç½‘ç»œç©å®¶åŒæ­¥é—®é¢˜æ·±åº¦åˆ†æä¸ä¿®å¤æŠ¥å‘Š

## ğŸ” é—®é¢˜åˆ†æ

### 1. ç¢°æ’ç®±ä¸æ¨¡å‹æ¸²æŸ“ä½ç½®ä¸ä¸€è‡´é—®é¢˜

**é—®é¢˜åŸå› :**
- `Transform`ä½ç½®ä¸`Rigidbody`ä½ç½®ä¸åŒæ­¥
- è¿œç¨‹ç©å®¶çš„ç‰©ç†ç»„ä»¶çŠ¶æ€è®¾ç½®ä¸å½“
- æ’å€¼è¿‡ç¨‹ä¸­åªæ›´æ–°Transformï¼ŒæœªåŒæ­¥Rigidbody

**ä¿®å¤æªæ–½:**
```csharp
// 1. ç¡®ä¿è¿œç¨‹ç©å®¶Rigidbodyè®¾ç½®æ­£ç¡®
if (_rigidbody != null)
{
    _rigidbody.isKinematic = true; // è¿œç¨‹ç©å®¶ä½¿ç”¨Kinematicæ¨¡å¼
    _rigidbody.useGravity = false; // ç¦ç”¨é‡åŠ›
    _rigidbody.velocity = Vector3.zero;
    _rigidbody.angularVelocity = Vector3.zero;
}

// 2. æ’å€¼æ—¶åŒæ—¶æ›´æ–°Transformå’ŒRigidbody
if (_rigidbody != null && !_rigidbody.isKinematic)
{
    _rigidbody.MovePosition(targetPosition);
    _rigidbody.MoveRotation(targetRotation);
}

// 3. æ·»åŠ å¼ºåˆ¶åŒæ­¥æ£€æŸ¥
private void SyncRemotePlayerPhysics()
{
    if (Vector3.Distance(_rigidbody.position, transform.position) > 0.01f)
    {
        _rigidbody.position = transform.position;
    }
}
```

### 2. ç©å®¶ä½ç½®æŠ–åŠ¨é—®é¢˜

**é—®é¢˜åŸå› :**
- ç½‘ç»œæ•°æ®åŒ…åˆ°è¾¾æ—¶é—´ä¸è§„å¾‹
- æ’å€¼ç®—æ³•ä¸å¤Ÿç¨³å®š
- é¢‘ç¹çš„ç¬ç§»æ“ä½œ
- é¢„æµ‹è¡¥å¿ç®—æ³•è¿‡äºå¤æ‚å¯¼è‡´è¯¯åˆ¤

**ä¿®å¤æªæ–½:**
```csharp
// 1. åˆ é™¤å¤æ‚çš„é¢„æµ‹è¡¥å¿åŠŸèƒ½
// ç§»é™¤äº† _enableClientPrediction, _enableLagCompensation ç­‰åŠŸèƒ½

// 2. æ”¹è¿›æ’å€¼ç®—æ³•
float lerpSpeed = Time.deltaTime * _interpolationRate;
Vector3 targetPosition = Vector3.Lerp(transform.position, _networkPosition, lerpSpeed);

// 3. ç¬ç§»æ—¶æ¸…é™¤é€Ÿåº¦
if (distance > _snapThreshold)
{
    _rigidbody.velocity = Vector3.zero;
    _rigidbody.angularVelocity = Vector3.zero;
}

// 4. æ·»åŠ è¯Šæ–­åŠŸèƒ½
private void DiagnoseSyncIssues()
{
    float posError = Vector3.Distance(transform.position, _networkPosition);
    if (posError > _positionErrorThreshold)
    {
        Debug.LogWarning($"ä½ç½®è¯¯å·®è¿‡å¤§: {posError:F3}m");
    }
}
```

## ğŸ› ï¸ ä»£ç æ”¹è¿›

### 1. ç²¾ç®€çš„NetworkPlayerControllerç‰¹æ€§

**åˆ é™¤çš„å¤æ‚åŠŸèƒ½:**
- å®¢æˆ·ç«¯é¢„æµ‹ (`_enableClientPrediction`)
- å»¶è¿Ÿè¡¥å¿ (`_enableLagCompensation`)
- çŠ¶æ€å†å²è®°å½• (`_stateHistory`)
- æœåŠ¡å™¨æ ¡æ­£ (`ServerReconciliation`)
- é¢„æµ‹ä½ç½® (`PredictedPosition`)

**ä¿ç•™çš„æ ¸å¿ƒåŠŸèƒ½:**
- åŸºç¡€ä½ç½®åŒæ­¥
- å¯é€‰çš„å¹³æ»‘æ’å€¼
- åŸºç¡€å»¶è¿Ÿç›‘æµ‹
- è°ƒè¯•è¨ºæ–­

### 2. æ”¹è¿›çš„æ’å€¼ç³»ç»Ÿ

```csharp
public class NetworkPlayerController : NetworkSyncBase
{
    [Header("å¹³æ»‘æ’å€¼")]
    [SerializeField] private bool _enableSmoothing = true;
    
    [Header("åŒæ­¥é—®é¢˜è¯Šæ–­")]
    [SerializeField] private bool _enableSyncDiagnostics = false;
    [SerializeField] private float _positionErrorThreshold = 0.1f;
    
    // ç®€åŒ–çš„æ’å€¼é€»è¾‘
    private void InterpolateRemotePlayer()
    {
        float distance = Vector3.Distance(transform.position, _networkPosition);
        
        if (distance > _snapThreshold)
        {
            // ç¬ç§» + ç‰©ç†åŒæ­¥
            transform.position = _networkPosition;
            _rigidbody.position = _networkPosition;
            _rigidbody.velocity = Vector3.zero; // æ¸…é™¤é€Ÿåº¦
        }
        else if (_enableSmoothing)
        {
            // å¹³æ»‘æ’å€¼ + ç‰©ç†åŒæ­¥
            Vector3 targetPosition = Vector3.Lerp(transform.position, _networkPosition, 
                Time.deltaTime * _interpolationRate);
            transform.position = targetPosition;
            _rigidbody.MovePosition(targetPosition);
        }
    }
}
```

## ğŸ“Š ä¸PlayerStatusManagerçš„åŒæ­¥å…³ç³»

### 1. æ•°æ®æµå‘

```
æœ¬åœ°ç©å®¶:
PlayerMotor/PlayerInput â†’ PlayerStatusManager â†’ NetworkPlayerController â†’ ç½‘ç»œ

è¿œç¨‹ç©å®¶:
ç½‘ç»œ â†’ NetworkPlayerController â†’ PlayerStatusManager â†’ åŠ¨ç”»ç³»ç»Ÿ
```

### 2. çŠ¶æ€åŒæ­¥æœºåˆ¶

**PlayerStatusManager.cs** è´Ÿè´£çŠ¶æ€æ”¶é›†ï¼š
```csharp
private PlayerStateData CollectCurrentState()
{
    if (photonView.IsMine)
    {
        return CollectLocalPlayerState(); // ä»ç»„ä»¶ç›´æ¥è¯»å–
    }
    else
    {
        return CollectRemotePlayerState(); // ä»ç½‘ç»œæ•°æ®è·å–
    }
}

private PlayerStateData CollectRemotePlayerState()
{
    var networkController = GetComponent<NetworkPlayerController>();
    if (networkController != null && networkController.HasRemotePlayerState())
    {
        var remoteState = networkController.GetRemotePlayerState();
        // åˆå¹¶ç½‘ç»œçŠ¶æ€å’Œæœ¬åœ°å¥åº·/æ­¦å™¨çŠ¶æ€
        return remoteState;
    }
}
```

### 3. æ½œåœ¨çš„åŒæ­¥é—®é¢˜

**é—®é¢˜1: åŒé‡çŠ¶æ€ç®¡ç†**
- NetworkPlayerControllerç®¡ç†ä½ç½®/è¾“å…¥çŠ¶æ€
- PlayerStatusManagerç®¡ç†å¥åº·/æ­¦å™¨çŠ¶æ€  
- å¯èƒ½å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ:**
```csharp
// åœ¨NetworkPlayerControllerä¸­æ˜ç¡®æ•°æ®è¾¹ç•Œ
public PlayerStateData GetRemotePlayerState()
{
    if (IsLocalPlayer) return PlayerStateData.Empty;
    return _remotePlayerState; // åªè¿”å›ä»ç½‘ç»œæ¥æ”¶çš„çŠ¶æ€
}

// åœ¨PlayerStatusManagerä¸­åˆå¹¶çŠ¶æ€
private PlayerStateData CollectRemotePlayerState()
{
    var remoteState = networkController.GetRemotePlayerState();
    // åˆå¹¶ç½‘ç»œçŠ¶æ€ + æœ¬åœ°ç®¡ç†çš„å¥åº·/æ­¦å™¨çŠ¶æ€
    remoteState.currentHealth = _currentHealth;
    remoteState.hasWeapon = CurrentWeapon != null;
    return remoteState;
}
```

**é—®é¢˜2: æ›´æ–°é¢‘ç‡ä¸åŒ¹é…**
- NetworkPlayerController: 30Hzå‘é€ï¼Œæ¯å¸§æ’å€¼
- PlayerStatusManager: å¯é…ç½®é¢‘ç‡æ›´æ–°
- å¯èƒ½å¯¼è‡´çŠ¶æ€æ›´æ–°ä¸åŒæ­¥

**è§£å†³æ–¹æ¡ˆ:**
```csharp
// ç»Ÿä¸€æ›´æ–°é¢‘ç‡æˆ–æ·»åŠ ç¼“å†²æœºåˆ¶
private void Update()
{
    if (!IsLocalPlayer)
    {
        InterpolateRemotePlayer();
        SyncRemotePlayerPhysics(); // ç¡®ä¿ç‰©ç†åŒæ­¥
        LogSyncStats();
    }
}
```

## ğŸ”¬ PlayerStatusManageræ·±åº¦è°ƒè¯•åˆ†æ

### 1. PlayerStatusManagerçš„æ ¸å¿ƒé—®é¢˜

PlayerStatusManagerä½œä¸ºçŠ¶æ€ç®¡ç†ä¸­æ¢ï¼Œå­˜åœ¨ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

**é—®é¢˜1: æœ¬åœ°/è¿œç¨‹çŠ¶æ€æ”¶é›†é€»è¾‘æ··ä¹±**
```csharp
// å½“å‰å­˜åœ¨çš„é—®é¢˜
private PlayerStateData CollectCurrentState()
{
    if (photonView.IsMine)
    {
        return CollectLocalPlayerState(); // ä»å¯ç”¨çš„ç»„ä»¶è¯»å–
    }
    else
    {
        return CollectRemotePlayerState(); // ä»ç½‘ç»œæ•°æ®è·å–
    }
}
```

**é—®é¢˜åˆ†æ:**
- æœ¬åœ°ç©å®¶ç›´æ¥ä»PlayerMotor/PlayerInputè¯»å–å®æ—¶æ•°æ®
- è¿œç¨‹ç©å®¶ä¾èµ–NetworkPlayerControllerçš„ç¼“å­˜æ•°æ®
- ä¸¤ç§æ•°æ®æºçš„æ—¶é—´æˆ³å’Œæ›´æ–°é¢‘ç‡ä¸ä¸€è‡´
- å¯èƒ½å¯¼è‡´çŠ¶æ€è·³è·ƒå’Œä¸è¿ç»­

**é—®é¢˜2: è¿œç¨‹çŠ¶æ€æ•°æ®ä¾èµ–é“¾è¿‡é•¿**
```
ç½‘ç»œæ•°æ® â†’ NetworkPlayerController._targetState â†’ 
NetworkPlayerController._remotePlayerState â†’ 
PlayerStatusManager.CollectRemotePlayerState() â†’ 
PlayerStatusManager.CurrentState
```

**é—®é¢˜3: åŒé‡ç½‘ç»œåŒæ­¥å†²çª**
```csharp
// PlayerStatusManagerè‡ªå·±ä¹Ÿæœ‰ç½‘ç»œåŒæ­¥
protected override void WriteData(PhotonStream stream)
{
    stream.SendNext(CurrentWeaponIndex);
    stream.SendNext(CurrentWeapon?.CurrentAmmo ?? 0);
    stream.SendNext(CurrentWeapon?.IsReloading ?? false);
    stream.SendNext(_currentHealth);
    stream.SendNext(_isAlive);
}

// åŒæ—¶NetworkPlayerControllerä¹Ÿåœ¨åŒæ­¥çŠ¶æ€
protected override void WriteData(PhotonStream stream)
{
    stream.SendNext(_networkState.position);
    stream.SendNext(_networkState.isSprinting);
    stream.SendNext(_networkState.isJumping);
    // ... é‡å¤çš„çŠ¶æ€æ•°æ®
}
```

### 2. æ¨èçš„è°ƒè¯•ç­–ç•¥

#### A. æ·»åŠ çŠ¶æ€æ”¶é›†è¯Šæ–­
```csharp
[Header("çŠ¶æ€æ”¶é›†è°ƒè¯•")]
[SerializeField] private bool _debugStateCollection = false;
[SerializeField] private bool _debugRemoteStateSource = false;

private PlayerStateData CollectCurrentState()
{
    PlayerStateData newState;
    
    if (photonView.IsMine)
    {
        newState = CollectLocalPlayerState();
        if (_debugStateCollection)
        {
            Debug.Log($"[çŠ¶æ€æ”¶é›†-æœ¬åœ°] ä½ç½®:{transform.position} " +
                $"é€Ÿåº¦:{newState.velocity} å†²åˆº:{newState.isSprinting}");
        }
    }
    else
    {
        newState = CollectRemotePlayerState();
        if (_debugStateCollection)
        {
            Debug.Log($"[çŠ¶æ€æ”¶é›†-è¿œç¨‹] ä½ç½®:{transform.position} " +
                $"ç½‘ç»œä½ç½®:{newState.velocity} å†²åˆº:{newState.isSprinting} " +
                $"æ•°æ®æº:{(_remoteDataSource ?? "Unknown")}");
        }
    }
    
    return newState;
}
```

#### B. è¿œç¨‹çŠ¶æ€æ•°æ®æºè¿½è¸ª
```csharp
private string _remoteDataSource; // è°ƒè¯•ç”¨ï¼šè®°å½•æ•°æ®æ¥æº

private PlayerStateData CollectRemotePlayerState()
{
    var networkController = GetComponent<NetworkPlayerController>();
    
    if (networkController != null && networkController.HasRemotePlayerState())
    {
        var remoteState = networkController.GetRemotePlayerState();
        _remoteDataSource = "NetworkPlayerController";
        
        if (_debugRemoteStateSource)
        {
            Debug.Log($"[è¿œç¨‹çŠ¶æ€æº] ä»NetworkPlayerControllerè·å– " +
                $"ä½ç½®:{remoteState.velocity} æ—¶é—´:{Time.time}");
        }
        
        // éªŒè¯æ•°æ®å®Œæ•´æ€§
        if (remoteState.speed < 0 || float.IsNaN(remoteState.speed))
        {
            Debug.LogError($"[çŠ¶æ€æ”¶é›†é”™è¯¯] æ— æ•ˆçš„é€Ÿåº¦æ•°æ®: {remoteState.speed}");
        }
        
        return MergeRemoteStateWithLocalData(remoteState);
    }
    
    _remoteDataSource = "Fallback";
    return CreateFallbackState();
}

private PlayerStateData MergeRemoteStateWithLocalData(PlayerStateData remoteState)
{
    // åˆå¹¶ç½‘ç»œçŠ¶æ€å’Œæœ¬åœ°ç®¡ç†çš„æ•°æ®
    var mergedState = remoteState;
    mergedState.currentHealth = _currentHealth;
    mergedState.maxHealth = _maxHealth;
    mergedState.isAlive = _isAlive;
    mergedState.hasWeapon = CurrentWeapon != null;
    mergedState.currentWeaponIndex = CurrentWeaponIndex;
    
    if (_debugRemoteStateSource)
    {
        Debug.Log($"[çŠ¶æ€åˆå¹¶] ç½‘ç»œ:{remoteState.isSprinting} + æœ¬åœ°å¥åº·:{_currentHealth}");
    }
    
    return mergedState;
}
```

#### C. æ›´æ–°é¢‘ç‡åŒæ­¥æ£€æµ‹
```csharp
[Header("æ›´æ–°é¢‘ç‡è°ƒè¯•")]
[SerializeField] private bool _debugUpdateFrequency = false;

private float _lastLocalStateTime;
private float _lastRemoteStateTime;
private int _localUpdateCount;
private int _remoteUpdateCount;

private void UpdateState()
{
    try
    {
        _previousState = CurrentState;
        CurrentState = CollectCurrentState();
        
        // è®°å½•æ›´æ–°é¢‘ç‡
        if (photonView.IsMine)
        {
            _lastLocalStateTime = Time.time;
            _localUpdateCount++;
        }
        else
        {
            _lastRemoteStateTime = Time.time;
            _remoteUpdateCount++;
        }
        
        if (!CurrentState.Equals(_previousState))
        {
            DistributeStateEvents();
            
            if (_debugUpdateFrequency)
            {
                LogStateChange();
            }
        }
    }
    catch (System.Exception ex)
    {
        Debug.LogError($"[PlayerStatusManager] UpdateStateå¼‚å¸¸: {ex.Message}");
        CurrentState = CreateSafeDefaultState();
    }
}

private void LogStateChange()
{
    string changeType = photonView.IsMine ? "æœ¬åœ°" : "è¿œç¨‹";
    Debug.Log($"[çŠ¶æ€å˜åŒ–-{changeType}] " +
        $"ä½ç½®å˜åŒ–:{Vector3.Distance(_previousState.velocity, CurrentState.velocity):F3} " +
        $"å†²åˆº:{_previousState.isSprinting}â†’{CurrentState.isSprinting} " +
        $"æ›´æ–°è®¡æ•°:{(photonView.IsMine ? _localUpdateCount : _remoteUpdateCount)}");
}
```

#### D. ç½‘ç»œåŒæ­¥å†²çªæ£€æµ‹
```csharp
[Header("ç½‘ç»œåŒæ­¥å†²çªè°ƒè¯•")]
[SerializeField] private bool _debugNetworkConflicts = false;

private NetworkPlayerState _lastNetworkControllerState;

protected override void WriteData(PhotonStream stream)
{
    // æ£€æµ‹ä¸NetworkPlayerControllerçš„æ•°æ®å†²çª
    var networkController = GetComponent<NetworkPlayerController>();
    if (networkController != null && _debugNetworkConflicts)
    {
        // æ¯”è¾ƒä¸¤ä¸ªç»„ä»¶è¦å‘é€çš„æ•°æ®æ˜¯å¦ä¸€è‡´
        var currentNetworkState = networkController.GetCurrentNetworkState();
        if (!CompareNetworkStates(_lastNetworkControllerState, currentNetworkState))
        {
            Debug.LogWarning($"[ç½‘ç»œå†²çª] PlayerStatusManagerå’ŒNetworkPlayerController " +
                $"å‘é€çš„çŠ¶æ€æ•°æ®ä¸ä¸€è‡´ï¼");
        }
        _lastNetworkControllerState = currentNetworkState;
    }
    
    // å‘é€çŠ¶æ€æ•°æ®...
    stream.SendNext(CurrentWeaponIndex);
    stream.SendNext(CurrentWeapon?.CurrentAmmo ?? 0);
    stream.SendNext(CurrentWeapon?.IsReloading ?? false);
    stream.SendNext(_currentHealth);
    stream.SendNext(_isAlive);
}

private bool CompareNetworkStates(NetworkPlayerState state1, NetworkPlayerState state2)
{
    // æ¯”è¾ƒå…³é”®çŠ¶æ€å­—æ®µ
    return Mathf.Approximately(state1.speed, state2.speed) &&
           state1.isSprinting == state2.isSprinting &&
           state1.isJumping == state2.isJumping;
}
```

### 3. çŠ¶æ€åŒæ­¥æ—¶åºé—®é¢˜

**é—®é¢˜è¯†åˆ«:**
```csharp
// PlayerStatusManageræ›´æ–°: å¯é…ç½®é¢‘ç‡ (é»˜è®¤30Hz)
float updateFrequency = photonView.IsMine ? _updateInterval : _updateInterval * 2f;

// NetworkPlayerControlleræ›´æ–°: æ¯å¸§ (60-120Hz)
private void Update()
{
    if (!IsLocalPlayer)
    {
        InterpolateRemotePlayer(); // æ¯å¸§æ‰§è¡Œ
    }
}
```

**æ—¶åºå†²çªåæœ:**
- PlayerStatusManagerä»¥30Hzæ›´æ–°çŠ¶æ€å¿«ç…§
- NetworkPlayerControllerä»¥60Hzæ’å€¼ä½ç½®
- å¯¼è‡´çŠ¶æ€æ•°æ®å’Œä½ç½®æ•°æ®æ›´æ–°ä¸åŒæ­¥
- é€ æˆ"çŠ¶æ€å»¶è¿Ÿäºä½ç½®"çš„ç°è±¡

**è§£å†³æ–¹æ¡ˆ:**
```csharp
// åœ¨PlayerStatusManagerä¸­æ·»åŠ å¼ºåˆ¶åŒæ­¥æœºåˆ¶
private void LateUpdate()
{
    if (!photonView.IsMine)
    {
        // ç¡®ä¿çŠ¶æ€ä¸NetworkPlayerControlleråŒæ­¥
        SyncWithNetworkController();
    }
}

private void SyncWithNetworkController()
{
    var networkController = GetComponent<NetworkPlayerController>();
    if (networkController != null)
    {
        // å¼ºåˆ¶æ›´æ–°çŠ¶æ€ä»¥åŒ¹é…æœ€æ–°çš„ç½‘ç»œä½ç½®
        if (Time.time - _lastUpdateTime > 0.016f) // 60Hzå¼ºåˆ¶åŒæ­¥
        {
            UpdateState();
        }
    }
}
```

### 4. æ•°æ®ä¸€è‡´æ€§éªŒè¯

```csharp
[Header("æ•°æ®ä¸€è‡´æ€§éªŒè¯")]
[SerializeField] private bool _validateDataConsistency = false;

private void ValidateStateConsistency()
{
    if (!_validateDataConsistency) return;
    
    var networkController = GetComponent<NetworkPlayerController>();
    if (networkController == null) return;
    
    // éªŒè¯ä½ç½®ä¸€è‡´æ€§
    Vector3 statusManagerPosition = CurrentState.velocity; // è¿™é‡Œåº”è¯¥æ˜¯positionå­—æ®µ
    Vector3 networkControllerPosition = networkController.transform.position;
    float positionDiff = Vector3.Distance(statusManagerPosition, networkControllerPosition);
    
    if (positionDiff > 0.1f)
    {
        Debug.LogError($"[ä¸€è‡´æ€§é”™è¯¯] StatusManagerä½ç½®:{statusManagerPosition} " +
            $"vs NetworkControllerä½ç½®:{networkControllerPosition} " +
            $"å·®å¼‚:{positionDiff:F3}m");
    }
    
    // éªŒè¯çŠ¶æ€æ—¶é—´æˆ³
    float timeDiff = Mathf.Abs(CurrentState.speed - Time.time); // å‡è®¾speedå­—æ®µå­˜å‚¨æ—¶é—´æˆ³
    if (timeDiff > 0.1f)
    {
        Debug.LogWarning($"[æ—¶åºè­¦å‘Š] çŠ¶æ€æ—¶é—´æˆ³è¿‡æ—§: {timeDiff:F3}s");
    }
}
```

## ğŸ“ˆ é¢„æœŸæ”¹è¿›æ•ˆæœ

1. **æ¶ˆé™¤ç¢°æ’ç®±ä½ç½®ä¸ä¸€è‡´**: é€šè¿‡åŒæ­¥Transformå’ŒRigidbodyä½ç½®
2. **å‡å°‘ä½ç½®æŠ–åŠ¨**: ç§»é™¤å¤æ‚é¢„æµ‹ç®—æ³•ï¼Œä½¿ç”¨ç¨³å®šæ’å€¼
3. **æé«˜ç½‘ç»œç¨³å®šæ€§**: ç®€åŒ–åŒæ­¥é€»è¾‘ï¼Œå‡å°‘è®¡ç®—å¼€é”€
4. **å¢å¼ºè°ƒè¯•èƒ½åŠ›**: æ·»åŠ è¯¦ç»†çš„è¯Šæ–­å’Œç»Ÿè®¡ä¿¡æ¯

é€šè¿‡è¿™äº›æ”¹è¿›ï¼Œç½‘ç»œåŒæ­¥åº”è¯¥å˜å¾—æ›´åŠ ç¨³å®šå’Œå¯é¢„æµ‹ã€‚

## å…·ä½“ä¿®å¤å»ºè®®

#### A. é‡æ„çŠ¶æ€æ”¶é›†é€»è¾‘
```csharp
// å»ºè®®çš„æ”¹è¿›ç‰ˆæœ¬
public class PlayerStatusManager : NetworkSyncBase, IDamageable
{
    [Header("è°ƒè¯•ä¸è¯Šæ–­")]
    [SerializeField] private bool _enableDeepDebugging = false;
    [SerializeField] private bool _logStateTransitions = false;
    [SerializeField] private bool _validateNetworkSync = false;
    
    private struct StateCollectionMetrics
    {
        public float lastUpdateTime;
        public int updateCount;
        public string dataSource;
        public float dataFreshness; // æ•°æ®æ–°é²œåº¦(ç§’)
    }
    
    private StateCollectionMetrics _metrics;
    
    private PlayerStateData CollectCurrentState()
    {
        _metrics.lastUpdateTime = Time.time;
        _metrics.updateCount++;
        
        PlayerStateData newState;
        
        if (photonView.IsMine)
        {
            newState = CollectLocalPlayerState();
            _metrics.dataSource = "LocalComponents";
            _metrics.dataFreshness = 0f; // å®æ—¶æ•°æ®
        }
        else
        {
            newState = CollectRemotePlayerStateWithValidation();
            _metrics.dataFreshness = Time.time - newState.lastUpdateTime; // å‡è®¾æ·»åŠ æ—¶é—´æˆ³å­—æ®µ
        }
        
        if (_enableDeepDebugging)
        {
            LogStateCollectionDetails(newState);
        }
        
        return newState;
    }
    
    private PlayerStateData CollectRemotePlayerStateWithValidation()
    {
        var networkController = GetComponent<NetworkPlayerController>();
        
        if (networkController == null)
        {
            Debug.LogError("[PlayerStatusManager] NetworkPlayerControllerç»„ä»¶ç¼ºå¤±ï¼");
            _metrics.dataSource = "Error-NoNetworkController";
            return CreateEmergencyFallbackState();
        }
        
        if (!networkController.HasRemotePlayerState())
        {
            Debug.LogWarning("[PlayerStatusManager] NetworkPlayerControlleræ— æœ‰æ•ˆè¿œç¨‹çŠ¶æ€");
            _metrics.dataSource = "Warning-NoRemoteState";
            return CreateTemporaryFallbackState();
        }
        
        var remoteState = networkController.GetRemotePlayerState();
        _metrics.dataSource = "NetworkController";
        
        // æ•°æ®æœ‰æ•ˆæ€§éªŒè¯
        if (!ValidateRemoteStateData(remoteState))
        {
            Debug.LogError("[PlayerStatusManager] è¿œç¨‹çŠ¶æ€æ•°æ®éªŒè¯å¤±è´¥ï¼");
            _metrics.dataSource = "Error-InvalidData";
            return CreateSafeRemoteState(remoteState);
        }
        
        return MergeRemoteStateWithLocalData(remoteState);
    }
    
    private bool ValidateRemoteStateData(PlayerStateData state)
    {
        // æ£€æŸ¥æ•°æ®åˆç†æ€§
        if (float.IsNaN(state.speed) || float.IsInfinity(state.speed))
        {
            Debug.LogError($"æ— æ•ˆçš„é€Ÿåº¦å€¼: {state.speed}");
            return false;
        }
        
        if (state.speed < 0 || state.speed > 50f) // å‡è®¾æœ€å¤§é€Ÿåº¦50m/s
        {
            Debug.LogWarning($"å¼‚å¸¸çš„é€Ÿåº¦å€¼: {state.speed}");
            return false;
        }
        
        if (Vector3.Distance(Vector3.zero, state.velocity) > 100f) // å¼‚å¸¸å¤§çš„é€Ÿåº¦å‘é‡
        {
            Debug.LogWarning($"å¼‚å¸¸çš„é€Ÿåº¦å‘é‡: {state.velocity}");
            return false;
        }
        
        return true;
    }
    
    private void LogStateCollectionDetails(PlayerStateData state)
    {
        Debug.Log($"[çŠ¶æ€æ”¶é›†è¯¦æƒ…] " +
            $"ç©å®¶:{(photonView.IsMine ? "æœ¬åœ°" : "è¿œç¨‹")} " +
            $"æ•°æ®æº:{_metrics.dataSource} " +
            $"æ–°é²œåº¦:{_metrics.dataFreshness:F3}s " +
            $"ä½ç½®:{transform.position} " +
            $"é€Ÿåº¦:{state.velocity} " +
            $"å†²åˆº:{state.isSprinting} " +
            $"æ›´æ–°è®¡æ•°:{_metrics.updateCount}");
    }
}
```

#### B. ç½‘ç»œåŒæ­¥åè°ƒæœºåˆ¶
```csharp
// åœ¨PlayerStatusManagerä¸­æ·»åŠ ä¸NetworkPlayerControllerçš„åè°ƒ
private void Start()
{
    // ç°æœ‰åˆå§‹åŒ–ä»£ç ...
    
    // è®¾ç½®ç½‘ç»œåŒæ­¥åè°ƒ
    var networkController = GetComponent<NetworkPlayerController>();
    if (networkController != null)
    {
        SetupNetworkSyncCoordination(networkController);
    }
}

private void SetupNetworkSyncCoordination(NetworkPlayerController networkController)
{
    if (!photonView.IsMine)
    {
        // ä¸ºè¿œç¨‹ç©å®¶è®¾ç½®åŒæ­¥å›è°ƒ
        networkController.OnRemoteStateUpdated += OnNetworkControllerStateUpdated;
        
        if (_enableDeepDebugging)
        {
            Debug.Log("[åŒæ­¥åè°ƒ] å·²å»ºç«‹ä¸NetworkPlayerControllerçš„è¿æ¥");
        }
    }
}

private void OnNetworkControllerStateUpdated(PlayerStateData newNetworkState)
{
    // å½“NetworkPlayerControlleræ”¶åˆ°æ–°çš„ç½‘ç»œçŠ¶æ€æ—¶ç«‹å³æ›´æ–°
    if (!photonView.IsMine)
    {
        ForceUpdateState(); // å¼ºåˆ¶æ›´æ–°çŠ¶æ€è€Œä¸ç­‰å¾…å®šæ—¶å™¨
        
        if (_logStateTransitions)
        {
            Debug.Log($"[åŒæ­¥åè°ƒ] å“åº”NetworkControllerçŠ¶æ€æ›´æ–°");
        }
    }
}

// æ·»åŠ å¼ºåˆ¶æ›´æ–°æ–¹æ³•
public void ForceUpdateState()
{
    _lastUpdateTime = 0f; // é‡ç½®æ—¶é—´ä»¥è§¦å‘ç«‹å³æ›´æ–°
    UpdateState();
}
```

#### C. ç½‘ç»œåŒæ­¥æ€§èƒ½ç›‘æ§
```csharp
[Header("æ€§èƒ½ç›‘æ§")]
[SerializeField] private bool _enablePerformanceMonitoring = false;

private struct SyncPerformanceMetrics
{
    public float averageUpdateInterval;
    public float maxUpdateInterval;
    public int missedUpdates;
    public float networkLatency;
    public float stateDataAge;
}

private SyncPerformanceMetrics _perfMetrics;
private Queue<float> _updateIntervals = new Queue<float>();
private const int MAX_INTERVAL_SAMPLES = 60;

private void MonitorSyncPerformance()
{
    if (!_enablePerformanceMonitoring) return;
    
    float currentTime = Time.time;
    float interval = currentTime - _perfMetrics.lastUpdateTime;
    
    _updateIntervals.Enqueue(interval);
    if (_updateIntervals.Count > MAX_INTERVAL_SAMPLES)
    {
        _updateIntervals.Dequeue();
    }
    
    // è®¡ç®—å¹³å‡æ›´æ–°é—´éš”
    float sum = 0f;
    float max = 0f;
    foreach (float intervalSample in _updateIntervals)
    {
        sum += intervalSample;
        if (intervalSample > max) max = intervalSample;
    }
    
    _perfMetrics.averageUpdateInterval = sum / _updateIntervals.Count;
    _perfMetrics.maxUpdateInterval = max;
    
    // æ£€æµ‹ä¸¢å¤±çš„æ›´æ–°
    if (interval > _updateInterval * 2f)
    {
        _perfMetrics.missedUpdates++;
        Debug.LogWarning($"[æ€§èƒ½è­¦å‘Š] æ£€æµ‹åˆ°æ›´æ–°å»¶è¿Ÿ: {interval:F3}s " +
            $"(æœŸæœ›: {_updateInterval:F3}s)");
    }
    
    // å®šæœŸæŠ¥å‘Šæ€§èƒ½æŒ‡æ ‡
    if (_perfMetrics.updateCount % 300 == 0) // æ¯300æ¬¡æ›´æ–°æŠ¥å‘Šä¸€æ¬¡
    {
        ReportPerformanceMetrics();
    }
}

private void ReportPerformanceMetrics()
{
    Debug.Log($"[æ€§èƒ½æŠ¥å‘Š] " +
        $"å¹³å‡æ›´æ–°é—´éš”:{_perfMetrics.averageUpdateInterval*1000:F1}ms " +
        $"æœ€å¤§é—´éš”:{_perfMetrics.maxUpdateInterval*1000:F1}ms " +
        $"ä¸¢å¤±æ›´æ–°:{_perfMetrics.missedUpdates} " +
        $"æ€»æ›´æ–°æ•°:{_perfMetrics.updateCount}");
}
```

### 6. æ¨èçš„è°ƒè¯•æµç¨‹

#### æ­¥éª¤1: å¯ç”¨åŸºç¡€è°ƒè¯•
```csharp
// åœ¨Inspectorä¸­è®¾ç½®è¿™äº›å‚æ•°
_enableDeepDebugging = true;
_debugStateCollection = true;
_debugRemoteStateSource = true;
```

#### æ­¥éª¤2: è§‚å¯ŸçŠ¶æ€æ”¶é›†æ—¥å¿—
æŸ¥æ‰¾ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š
- æ•°æ®æºç±»å‹ (LocalComponents vs NetworkController vs Fallback)
- æ•°æ®æ–°é²œåº¦ (è¿œç¨‹æ•°æ®çš„å»¶è¿Ÿæ—¶é—´)
- çŠ¶æ€è·³è·ƒ (sudden changes in state values)

#### æ­¥éª¤3: ç›‘æ§ç½‘ç»œåŒæ­¥å†²çª
```csharp
_debugNetworkConflicts = true;
_validateNetworkSync = true;
```

#### æ­¥éª¤4: åˆ†ææ€§èƒ½æŒ‡æ ‡
```csharp
_enablePerformanceMonitoring = true;
```

#### æ­¥éª¤5: éªŒè¯ä¿®å¤æ•ˆæœ
- ä½ç½®åŒæ­¥ç¨³å®šæ€§
- çŠ¶æ€å˜åŒ–çš„è¿ç»­æ€§
- ç½‘ç»œå»¶è¿Ÿå¯¹åŒæ­¥çš„å½±å“

### 7. å¸¸è§é—®é¢˜çš„è¯Šæ–­æŒ‡å—

**ç—‡çŠ¶**: è¿œç¨‹ç©å®¶ä½ç½®è·³è·ƒ
**å¯èƒ½åŸå› **: 
- NetworkPlayerControllerå’ŒPlayerStatusManageræ›´æ–°é¢‘ç‡ä¸åŒ¹é…
- è¿œç¨‹çŠ¶æ€æ•°æ®éªŒè¯å¤±è´¥ï¼Œå›é€€åˆ°é»˜è®¤çŠ¶æ€

**ç—‡çŠ¶**: åŠ¨ç”»çŠ¶æ€å»¶è¿Ÿ
**å¯èƒ½åŸå› **:
- PlayerStatusManagerä»NetworkPlayerControllerè·å–çš„çŠ¶æ€æ•°æ®è¿‡æ—¶
- çŠ¶æ€åˆå¹¶é€»è¾‘ä¸­ä¸¢å¤±äº†æ—¶é—´æ•æ„Ÿçš„æ•°æ®

**ç—‡çŠ¶**: ç¢°æ’æ£€æµ‹å¼‚å¸¸
**å¯èƒ½åŸå› **:
- Transformä½ç½®ä¸Rigidbodyä½ç½®ä¸åŒæ­¥
- PlayerStatusManagerçš„çŠ¶æ€ä¸å®é™…ç‰©ç†çŠ¶æ€ä¸ä¸€è‡´

## ğŸ”§ PlayerStatusManager å…·ä½“ä¿®å¤å»ºè®®

åŸºäºæ·±åº¦è°ƒè¯•åˆ†æï¼Œä»¥ä¸‹æ˜¯é’ˆå¯¹PlayerStatusManagerçš„å…·ä½“ä¿®å¤å»ºè®®ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ç½‘ç»œåŒæ­¥çš„ç¨³å®šæ€§å’Œå¯è°ƒè¯•æ€§ã€‚

### 1. é‡æ„çŠ¶æ€æ”¶é›†é€»è¾‘

**é—®é¢˜**: CollectRemotePlayerStateæ–¹æ³•ä¾èµ–NetworkPlayerControllerçš„GetRemotePlayerStateï¼Œä½†æ²¡æœ‰å¤„ç†è¯¥æ–¹æ³•è¿”å›ç©ºæˆ–å¤±æ•ˆçŠ¶æ€çš„æƒ…å†µã€‚

**è§£å†³æ–¹æ¡ˆ**:
```csharp
private PlayerStateData CollectRemotePlayerState()
{
    // 1. å…ˆè·å–ç»„ä»¶å’Œæ£€æŸ¥æœ‰æ•ˆæ€§
    var networkController = GetComponent<NetworkPlayerController>();
    if (networkController == null)
    {
        AddDebugLog("[ERROR] è¿œç¨‹ç©å®¶ç¼ºå°‘NetworkPlayerControllerç»„ä»¶");
        return CreateSafeDefaultState();
    }
    
    // 2. å°è¯•è·å–çŠ¶æ€å¹¶æ£€æŸ¥å®Œæ•´æ€§
    if (!networkController.HasRemotePlayerState())
    {
        AddDebugLog("[ERROR] NetworkPlayerControlleræœªæä¾›è¿œç¨‹çŠ¶æ€æ•°æ®");
        return CreateSafeDefaultState();
    }
    
    var remoteState = networkController.GetRemotePlayerState();
    
    // 3. éªŒè¯è¿œç¨‹çŠ¶æ€åŸºæœ¬åˆç†æ€§
    if (remoteState.speed < 0 || remoteState.speed > 100)
    {
        AddDebugLog($"[WARNING] æ¥æ”¶åˆ°çš„è¿œç¨‹çŠ¶æ€é€Ÿåº¦å¼‚å¸¸: {remoteState.speed}");
    }
    
    // 4. åˆå¹¶ç½‘ç»œçŠ¶æ€å’Œæœ¬åœ°å¥åº·/æ­¦å™¨çŠ¶æ€
    remoteState.currentHealth = _currentHealth;
    remoteState.maxHealth = _maxHealth;
    remoteState.isAlive = _isAlive;
    remoteState.hasWeapon = CurrentWeapon != null;
    remoteState.currentWeaponIndex = CurrentWeaponIndex;
    remoteState.currentAmmo = CurrentWeapon?.CurrentAmmo ?? 0;
    remoteState.maxAmmo = CurrentWeapon?.MaxAmmo ?? 0;
    remoteState.isReloading = CurrentWeapon?.IsReloading ?? false;
    remoteState.weaponName = CurrentWeapon?.WeaponData?.WeaponName ?? "";
    
    return remoteState;
}
```

### 2. ç½‘ç»œåŒæ­¥åè°ƒæœºåˆ¶

**é—®é¢˜**: RPCå’ŒNetworkSyncä¸¤ç§åŒæ­¥æœºåˆ¶å­˜åœ¨å†²çªï¼Œç‰¹åˆ«æ˜¯å¥åº·å€¼å¯èƒ½é€šè¿‡ä¸¤ç§é€”å¾„è¿›è¡ŒåŒæ­¥ã€‚

**è§£å†³æ–¹æ¡ˆ**:
```csharp
// 1. æ˜ç¡®åˆ†å·¥ï¼šRPCå¤„ç†åŠæ—¶æ€§è¦æ±‚é«˜çš„çŠ¶æ€ï¼ˆå¦‚å¥åº·å€¼ã€æ­»äº¡çŠ¶æ€ï¼‰
// 2. NetworkSyncå¤„ç†å¸¸è§„çŠ¶æ€ï¼ˆä½ç½®ã€é€Ÿåº¦ã€è¾“å…¥ç­‰ï¼‰
// 3. æ·»åŠ å†²çªæ£€æµ‹æœºåˆ¶

// åœ¨ReadDataä¸­
protected override void ReadData(PhotonStream stream, PhotonMessageInfo info)
{
    // è¯»å–åŸºæœ¬çŠ¶æ€
    int networkWeaponIndex = (int)stream.ReceiveNext();
    int networkAmmo = (int)stream.ReceiveNext();
    bool networkReloading = (bool)stream.ReceiveNext();
    
    // è¯»å–å¥åº·çŠ¶æ€ï¼ˆåªç”¨äºéªŒè¯ï¼Œä¸æ›´æ–°ï¼‰
    float networkHealth = (float)stream.ReceiveNext();
    bool networkAlive = (bool)stream.ReceiveNext();
    
    // å†²çªæ£€æµ‹
    if (_enableSyncDebugging)
    {
        float healthDifference = Mathf.Abs(_currentHealth - networkHealth);
        if (healthDifference > 5f)
        {
            _healthSyncConflictCount++;
            AddDebugLog($"å¥åº·å€¼åŒæ­¥å†²çª: RPCå€¼={_currentHealth}, NetworkSyncå€¼={networkHealth}");
        }
    }
    
    // åŒæ­¥éå…³é”®çŠ¶æ€ï¼ˆå¼¹è¯ç­‰ï¼‰
    if (CurrentWeaponIndex == networkWeaponIndex && CurrentWeapon != null)
    {
        // åªæ›´æ–°æ˜¾ç¤ºï¼Œä¸è§¦å‘äº‹ä»¶
    }
}
```

### 3. æ€§èƒ½ä¼˜åŒ–

**é—®é¢˜**: è¿œç¨‹ç©å®¶æ‰§è¡Œä¸å¿…è¦çš„çŠ¶æ€æ›´æ–°å’Œäº‹ä»¶è§¦å‘ï¼Œå¢åŠ æ€§èƒ½å¼€é”€ã€‚

**è§£å†³æ–¹æ¡ˆ**:
```csharp
private void Update()
{
    // å·®å¼‚åŒ–æ›´æ–°ç­–ç•¥
    if (photonView.IsMine)
    {
        // æœ¬åœ°ç©å®¶ï¼šå®Œæ•´æ›´æ–°
        if (Time.time - _lastUpdateTime >= _updateInterval)
        {
            UpdateState();
            _lastUpdateTime = Time.time;
            
            // å¥åº·æ¢å¤ç­‰æœ¬åœ°é€»è¾‘
            if (_enableHealthRegeneration && _isAlive && _currentHealth < _maxHealth)
            {
                float regenAmount = _healthRegenRate * Time.deltaTime;
                _currentHealth = Mathf.Min(_maxHealth, _currentHealth + regenAmount);
                OnHealthChanged?.Invoke(_currentHealth, _maxHealth);
            }
        }
    }
    else
    {
        // è¿œç¨‹ç©å®¶ï¼šç®€åŒ–æ›´æ–°ï¼Œå‡å°‘é¢‘ç‡
        if (Time.time - _lastUpdateTime >= _updateInterval * 2f)
        {
            // åªæ›´æ–°å¿…è¦çŠ¶æ€
            UpdateRemotePlayerState();
            _lastUpdateTime = Time.time;
        }
    }
    
    // è°ƒè¯•æ›´æ–°ï¼ˆæ ¹æ®éœ€è¦è°ƒæ•´é¢‘ç‡ï¼‰
    if (_enableSyncDebugging && Time.time - _lastDebugUpdateTime >= 0.5f)
    {
        UpdateDebugStatistics();
        _lastDebugUpdateTime = Time.time;
    }
}
```

### 4. è°ƒè¯•ä¸ç›‘æ§ç³»ç»Ÿ

**é—®é¢˜**: ç¼ºä¹å…¨é¢çš„è°ƒè¯•æœºåˆ¶ï¼Œéš¾ä»¥å®šä½å¼‚æ­¥å’Œç½‘ç»œé—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆ**:
```csharp
// 1. æ·»åŠ å…¨é¢çš„è°ƒè¯•å­—æ®µ
[Header("è°ƒè¯•ä¸ç›‘æ§é…ç½®")]
[SerializeField] private bool _enableSyncDebugging = false;
[SerializeField] private bool _enablePerformanceMonitoring = false;
[SerializeField] private bool _enableStateValidation = false;
[SerializeField] private float _syncWarningThreshold = 0.1f;
[SerializeField] private int _maxDebugLogEntries = 100;

// 2. å®ç°è°ƒè¯•ç»Ÿè®¡å­—æ®µ
// åŒæ­¥è°ƒè¯•ç»Ÿè®¡
private float _lastNetworkUpdateTime;
private int _networkUpdateCount;
private float _averageNetworkInterval;
private int _stateCollectionErrors;
private int _successfulStateUpdates;

// 3. æ·»åŠ è°ƒè¯•æ—¥å¿—ç³»ç»Ÿ
private System.Collections.Generic.Queue<string> _debugLogCache = new System.Collections.Generic.Queue<string>();

private void AddDebugLog(string message)
{
    string timestampedMessage = $"[{Time.time:F2}] {message}";
    _debugLogCache.Enqueue(timestampedMessage);
    
    while (_debugLogCache.Count > _maxDebugLogEntries)
    {
        _debugLogCache.Dequeue();
    }
    
    if (_showDebugInfo)
    {
        Debug.Log($"[PlayerStatusManager] {timestampedMessage}");
    }
}

// 4. æ·»åŠ è°ƒè¯•æŠ¥å‘Šç”ŸæˆåŠŸèƒ½
public string GetSyncDiagnosticReport()
{
    var report = new System.Text.StringBuilder();
    report.AppendLine("=== PlayerStatusManager åŒæ­¥è¯Šæ–­æŠ¥å‘Š ===");
    report.AppendLine($"ç©å®¶ID: {photonView.ViewID} (æœ¬åœ°: {photonView.IsMine})");
    report.AppendLine($"ç»„ä»¶çŠ¶æ€: {(_playerMotor?.enabled == true ? "æ­£å¸¸" : "å¼‚å¸¸")}");
    report.AppendLine($"é”™è¯¯ç‡: {GetErrorRate():F1}%");
    
    if (_enablePerformanceMonitoring)
    {
        report.AppendLine($"å¹³å‡æ‰§è¡Œæ—¶é—´: {_avgUpdateStateTime * 1000:F2}ms");
    }
    
    if (!photonView.IsMine)
    {
        report.AppendLine($"ä½ç½®åŒæ­¥è¯¯å·®: {_positionDiscrepancy:F3}m");
        report.AppendLine($"å¥åº·å€¼åŒæ­¥å†²çª: {_healthSyncConflictCount}æ¬¡");
    }
    
    return report.ToString();
}
```

### 5. å¸¸è§é—®é¢˜è¯Šæ–­ä¸ä¿®å¤æŒ‡å—

1. **è¿œç¨‹ç©å®¶æ— æ³•è·å–çŠ¶æ€**
   - ç—‡çŠ¶: `NetworkPlayerControlleræœªæä¾›è¿œç¨‹çŠ¶æ€æ•°æ®`è­¦å‘Š
   - æ£€æŸ¥ç‚¹: NetworkPlayerControlleræ˜¯å¦æ­£å¸¸æ¥æ”¶ç½‘ç»œæ•°æ®
   - ä¿®å¤: ç¡®ä¿NetworkPlayerControllerçš„`OnPhotonSerializeView`æ­£å¸¸æ‰§è¡Œ

2. **å¥åº·å€¼åŒæ­¥å†²çª**
   - ç—‡çŠ¶: è¿œç¨‹ç©å®¶çœ‹åˆ°çš„è¡€é‡ä¸å®é™…ä¸ç¬¦
   - æ£€æŸ¥ç‚¹: RPC_HealthChangedæ¥æ”¶æ—¶é—´ä¸NetworkSyncæ›´æ–°æ—¶é—´æ˜¯å¦ç›¸è¿‘
   - ä¿®å¤: æ˜ç¡®åˆ†ç¦»RPCå’ŒNetworkSyncçš„èŒè´£ï¼Œé¿å…ä¸¤è€…åŒæ—¶æ›´æ–°åŒä¸€çŠ¶æ€

3. **PlayerMotorç»„ä»¶è¢«æ„å¤–ç¦ç”¨**
   - ç—‡çŠ¶: è¿œç¨‹ç©å®¶çœ‹åˆ°æœ¬åœ°ç©å®¶é™æ­¢ä¸åŠ¨
   - æ£€æŸ¥ç‚¹: å…¶ä»–è„šæœ¬æ˜¯å¦åœ¨åˆ‡æ¢åœºæ™¯æˆ–é‡ç”Ÿæ—¶ç¦ç”¨äº†ç»„ä»¶
   - ä¿®å¤: ç¡®ä¿PlayerMotorçš„å¯ç”¨/ç¦ç”¨å§‹ç»ˆé€šè¿‡PlayerStatusManageræ§åˆ¶

4. **çŠ¶æ€æ”¶é›†é”™è¯¯ç‡è¿‡é«˜**
   - ç—‡çŠ¶: è°ƒè¯•æŠ¥å‘Šä¸­æ˜¾ç¤ºé”™è¯¯ç‡>5%
   - æ£€æŸ¥ç‚¹: æŸ¥çœ‹å…·ä½“å¼‚å¸¸ä¿¡æ¯ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ç©ºå¼•ç”¨æˆ–ç±»å‹è½¬æ¢é”™è¯¯
   - ä¿®å¤: æ·»åŠ æ›´å¤šç©ºæ£€æŸ¥å’Œç±»å‹éªŒè¯ï¼Œæå‡å¼‚å¸¸å¤„ç†çš„å¥å£®æ€§

é€šè¿‡å®æ–½ä»¥ä¸Šä¿®å¤å»ºè®®ï¼Œå¯ä»¥æ˜¾è‘—æé«˜PlayerStatusManagerçš„å¯é æ€§å’Œå¯è°ƒè¯•æ€§ï¼Œä»è€Œè§£å†³ç½‘ç»œåŒæ­¥ä¸­çš„å¤§éƒ¨åˆ†é—®é¢˜ã€‚
